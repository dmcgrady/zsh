#!/usr/bin/env zsh

echo "Reinstalling all programs..."

# --- STORAGE ---
PKG_STORE=$HOME/tmp
PACKAGES=$PKG_STORE/pkglist
PACKAGES_USER=$PKG_STORE/pkglist-user
PACKAGES_USER_LOCAL=$PKG_STORE/pkglist-user-local

# ---- PREPARE DIR ---
echo "> Clearing old lists..."
mkdir -p $PKG_STORE
rm $PKG_STORE/pkglist*

# --- Generate package lists ---
echo "> Generating package lists..."
# All packages
pacman -Qeq > $PACKAGES
# User installed packages
pacman -Qqet | grep -v "$(pacman -Qqg base)" | grep -v "$(pacman -Qqm)" > $PACKAGES_USER
# User installed local packages
pacman -Qm > $PACKAGES_USER_LOCAL

# --- Count packages ---
echo "> Counting packages to install..."
PACKAGE_COUNT="$(cat $PACKAGES | wc)"

echo "> Installing $PACKAGE_COUNT packages..."
yaourt -S $(cat $PACKAGES) --force --noconfirm

echo "> DONE!!!"
